(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1051:function(y,F,b){b.d(F,"a",function(){return a});y=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(y.b)("SupportStatus",a)},1398:function(y,F,b){function a(ba){var S=la.call(this)||this;S.$=ba;S.fc();return S}
function c(ba){this.oAuthManager=ba}function d(){}function l(ba){this.WTb=ba}function n(){}function m(){}b.r(F);y=b(0);var f=b(13),v=b(981),w=b(1051),t=b(5),A=b(95),x=b(857),u=b(273),B=b(47),r=b(23),I=b(87),z=b(338);m.prototype.ii=function(ba){ba.register(537,"Common.App.OAuth.IOAuthManager").Cc().Mc(function(){return new v.OAuthManager})};m.prototype.init=function(){var ba=I.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.kPj(ba)};m.prototype.kPj=function(ba){var S=t.AFrameworkApplication.ga.Ua("FileSource");
if(t.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||t.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===S){var H=x.a.yGh,T=x.a.authority;if(void 0!==H&&null!==H&&H.length&&void 0!==T&&null!==T&&T.length){var K=w.a[ba.SS],da=r.a.tGa,fa=ba.Pu();try{var W=new Map;void 0!==W&&null!==W?(W.set("SupportStatus",K),W.set("Browser",da),W.set("AuthStrategy",fa)):W=null}catch(ia){W=null}A.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",W);var ca=B.a.xe();ba.yS("Core",
H).then(function(ia){var ea=Math.floor(B.a.xe()-ca);K=w.a[ba.SS];da=r.a.tGa;fa=ba.Pu();f.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',ea,ia.IsSuccess,K,ia.ErrorCode,S,da,fa);W&&(W.set("SupportStatus",K),W.set("Browser",da),W.set("AuthStrategy",fa));ea=Object.assign(new z.a,{durationMs:ea,extendedProperties:W});ia.IsSuccess?A.Health.instance.recordKpiSuccess("WacCorePFT",
ea):A.Health.instance.recordKpiFailure("WacCorePFT",ia.ErrorCode,!1,!1,ea)})}}};m.prototype.dispose=function(){};m.main=function(){u.a.instance.rj(new m)};Qk.Object.defineProperties(m.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(y.a)(m,"OAuthPackage",null,[4,5]);var D=b(1078);Object(y.a)(n,"LokiTokenResult",null,[]);l.prototype.zfd=function(){var ba=this,S=this.CTh();return S?l.ppd?new Promise(function(H,T){ba.WTb.continueWith(function(){ba.WTb.Hh||
ba.WTb.kg?T(Error.create("Error downloading auth library")):ba.WTb.result.yS("Loki",S).then(function(K){K=t.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?ba.FTh():K.IsSuccess&&K.Token?Object.assign(new n,{isSuccess:!0,token:K.Token,errorMessage:null}):Object.assign(new n,{isSuccess:!1,token:null,errorMessage:JSON.stringify(K)});H(K);return K})})}):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):
Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",D.a.LXe())}))};l.prototype.FTh=function(){var ba=t.AFrameworkApplication.ga.Ua("LokiUserDataSignature")||"";return Object.assign(new n,{isSuccess:!0,token:ba,errorMessage:null})};l.prototype.CTh=function(){var ba=null,S=D.a.M$b();2===S?ba=t.AFrameworkApplication.ga.Ua("LokiAADAppId"):1===S&&(ba=t.AFrameworkApplication.ga.Ua("LokiMSAAppId"));return ba};Qk.Object.defineProperties(l,
{ppd:{configurable:!0,enumerable:!0,get:function(){return t.AFrameworkApplication.ga.ra("IsO365CommercialHost")||t.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});Object(y.a)(l,"LokiTokenManager",null,[548]);var V=b(525);d.prototype.init=function(){I.a.instance.resolve("Common.ILokiTokenManager")};d.prototype.dispose=function(){};d.prototype.ii=function(ba){ba.register(l,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Cc().Mc(function(){return new l(V.a.Sq(ba.pc("Common.App.OAuth.IOAuthManager")))})};
d.main=function(){u.a.instance.rj(new d)};Qk.Object.defineProperties(d.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(y.a)(d,"LivePersonaUtilsPackage",null,[4,5]);var U=b(10);F=b(214);var Q=b(946);c.prototype.yS=function(ba,S){return this.oAuthManager?this.oAuthManager.yS(ba,S).then(function(H){H.IsSuccess||f.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+H.ErrorMessage+" Error code: "+H.ErrorCode+" App name: "+
ba);return Object.assign(new Q.a,{IsSuccess:H.IsSuccess,Token:H.Token,ErrorCode:H.ErrorCode,ErrorMessage:H.ErrorMessage})}):(f.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new Q.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.LLa=function(){return this.oAuthManager?this.oAuthManager.LLa():null};Object(y.a)(c,"OAuthManagerWrapper",null,[540]);var la=F.a;vm(a,la);a.prototype.create=
function(){this.Gb(this.$.da.Aa(349)||new c(I.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ka=function(ba){ba.da.Ha(350,new a(ba))};Object(y.a)(a,"OAuthManagerFactory",F.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");m.main();Type.registerNamespace("Common.App.LivePersonaUtils");d.main();(function(){U.a.Ga(function(ba){a.ka(ba)})})()},981:function(y,F,b){function a(Ha){var Ya=this;Ha=void 0===Ha?
null:Ha;this.SS=0;this.jP=null;this.Yug=0;var Na=ea.a.xe();this.Aqg=this.oeh(Ha).then(function(eb){return eb?Ya.t$h():(u.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",Ya.Pu(),Math.floor(ea.a.xe()-Na)),eb=ia.a.Vr(),void 0!==eb&&null!==eb&&(eb.set("AuthLibrary",Ya.Pu()),eb=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.xe()-Na),extendedProperties:eb}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",
!1,!0,eb)),Promise.resolve(1))}).then(function(eb){return 0!==eb?Promise.resolve(eb):Ya.nti()})}function c(Ha){this.gPc=Ha;this.zXa="UnsupportedAuthTokenStrategy Reason="+r.a[this.gPc]}function d(){this.Gs=null;this.oSb=0;this.Hjb=this.MXa=this.UEc=this.CDa=this.kM=this.Rie=null;this.zv=new W.a(null,null);this.ZWb=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.zXa="SharedAuthTokenStrategy "+(this.ZWb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":
"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.hY=V.a.Gwj;this.Qge=V.a.Fwj;this.N5d=V.a.enableConsoleLogging;this.kog=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.Iwg=D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.ZWb);this.Tqa={};this.Lqg=new m(1500)}function l(Ha,Ya,Na,eb,Ia,lb,hc){var ma=fa.call(this,!1,!1,!0)||this;ma.x1=null;ma.b5d=null;ma.hY=Ha;ma.pug=Na;ma.zv=eb;
ma.jyg=Ia;ma.CDa=lb;ma.Gs=document.createElement("iframe");ma.Gs.id="SharedAuthInteractiveFrame";ma.Gs.setAttribute("name","SharedAuthInteractiveFrame");ma.Gs.setAttribute("title","SharedAuthInteractiveFrame");ma.Gs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");ma.Gs.style.border="0";ma.Gs.style.height="48px";ma.Gs.style.width="190px";$addHandler(ma.Gs,"error",Object(la.a)(ma,ma.eTi,"onSharedAuthFrameError"));Ha=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",ma.hY,
Ya,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",D.AFrameworkApplication.userType);hc&&(Ha+="&vnext=1");ma.Gs.src=Ha;ma.Rng=new Promise(function(Ja){ma.b5d=Ja});ma.c5d=!1;return ma}function n(){this.correlationId=this.resolve=null}function m(Ha){Ha=void 0===Ha?0:Ha;this.HB=0;this.Akb=!1;this.vm=new S.a;this._timeout=Ha}function f(){this.reject=this.resolve=null;this.startTime=0;this.IKf=this.Dte=null}function v(){this.Rje=null;var Ha=D.AFrameworkApplication.ga.Ua(D.AFrameworkApplication.vea),
Ya=D.AFrameworkApplication.ga.Ua(D.AFrameworkApplication.Cbg);this.zXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",Ha&&""!==Ha?Ha:"Unspecified",Ya&&""!==Ya?Ya:"Unspecified")}function w(Ha,Ya,Na,eb,Ia){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=Ha;this.scope=Ya;this.silentLogin=Na;this.options=eb;this.correlationId=Ia}function t(){}function A(Ha){this.Jsg=Ha}function x(){}b.r(F);y=b(0);var u=b(13),B=b(815),
r=b(1051),I;(function(Ha){Ha[Ha.external=0]="external";Ha[Ha.msa=1]="msa";Ha[Ha.aad=2]="aad"})(I||(I={}));Object(y.b)("AuthorityType",I);Object(y.a)(x,"OAuthResult",null,[]);A.prototype.initialize=function(){return Promise.resolve(0)};A.prototype.ujc=function(){return Promise.resolve(0)};A.prototype.yS=function(){u.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new x,{IsSuccess:!0,Token:this.Jsg}))};A.prototype.rAc=function(){return Promise.resolve(Object.assign(new x,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};A.prototype.Uyc=function(){return!1};A.prototype.Mvb=function(){return"MockAuthTokenStrategy"};Object(y.a)(A,"MockAuthTokenStrategy",null,[656]);var z=b(1078);t.get=function(Ha,Ya,Na){if(!Na)return Ha;var eb=0;return Promise.race([Ha,new Promise(function(Ia){eb=window.setTimeout(function(){Ia(Ya)},Na)})]).then(function(Ia){window.clearTimeout(eb);
return Promise.resolve(Ia)}).catch(function(){window.clearTimeout(eb);return Promise.resolve(Ya)})};Object(y.a)(t,"PromiseWithTimeout",null,[]);var D=b(5),V=b(857);Object(y.a)(w,"TokenRequestParameters",null,[676]);var U=b(23),Q=b(87);v.prototype.initialize=function(){var Ha=this;return new Promise(function(Ya){Q.a.instance.pc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Na){Ha.Rje=Na;Ya(0)})})};v.prototype.Ai=function(Ha){for(var Ya=!1,Na=Ha.toLocaleUpperCase(),eb=yl(["HTTPS:","API:"]),
Ia=eb.next();!Ia.done;Ia=eb.next())if(Na.startsWith(Ia.value)){Ya=!0;break}return Ya||this.vji(Ha)?Ha+"/.default":Ha};v.prototype.vji=function(Ha){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(Ha)};v.prototype.ujc=function(){return Promise.resolve(0)};v.prototype.yS=function(Ha,Ya,Na,eb,Ia,lb,hc){if(U.a.Wka){Ia=V.a.TXj;if(!Ia)return Ya=Object.assign(new x,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Ya);
if(!Array.contains(Ia,Ha))return Ya=Object.assign(new x,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+Ha}),Promise.resolve(Ya)}Ha=this.Ai(Na);Na=new w(Na,Ha,!eb,null,D.AFrameworkApplication.userSessionId);return this.Rje.getAccessToken(Na,Ya,hc).then(function(ma){return Object.assign(new x,{IsSuccess:!0,Token:ma.accessToken})},function(ma){return Object.assign(new x,{IsSuccess:!1,ErrorCode:ma})})};v.prototype.rAc=function(){return Promise.resolve(Object.assign(new x,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};v.prototype.Uyc=function(){return!1};v.prototype.Mvb=function(){return this.zXa};Object(y.a)(v,"ParentFrameTokenStrategy",null,[656]);var la=b(80),ba=b(988),S=b(185);Object(y.a)(f,"PromiseWrapper",null,[]);m.prototype.enqueue=function(Ha){var Ya=this;return new Promise(function(Na,eb){Ya.vm.add(Object.assign(new f,{IKf:Ha,resolve:Na,reject:eb}));
Ya.process()})};m.prototype.process=function(){var Ha=this;if(this.Akb||this.HB===this.vm.count)return!1;var Ya=this.vm.oa(this.HB++);try{this.Akb=!0,Ya.IKf().then(function(Na){Ha.Akb=!1;Ha.X1c(Ya,Na,null,!0)}).catch(function(Na){Ha.Akb=!1;Ha.X1c(Ya,null,Na,!1)})}catch(Na){this.Akb=!1,this.X1c(Ya,null,Na,!1)}return!0};m.prototype.X1c=function(Ha,Ya,Na,eb){var Ia=this;eb?0<this._timeout?window.setTimeout(function(){Ha.resolve(Ya);Ia.process()},this._timeout):(Ha.resolve(Ya),Ia.process()):0<this._timeout?
window.setTimeout(function(){Ha.reject(Na);Ia.process()},this._timeout):(Ha.reject(Na),Ia.process())};Object(y.a)(m,"PromiseQueue",null,[]);Object(y.a)(n,"ResolveWithCorrelation",null,[]);var H=b(84),T=b(140),K=b(961),da=b(170),fa=T.a;vm(l,fa);l.prototype.ixc=function(){var Ha={};Ha=(Ha.promptMessage=this.pug,Ha.errorText=CommonUIStrings.l_InternalError,Ha.rtl=D.AFrameworkApplication.isRtl,Ha.frameLoaded=!1,Ha.createFrame=Object(la.a)(this,this.M6g,"createFrame"),Ha.resolveDialogStyles=this.b5d,Ha);
var Ya={};this.x1=(Ya.id="SharedAuthConsentDialog",Ya.bodyControls=Ha,Ya);this.kc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(la.a)(this,this.Ewj,"sharedAuthConsentDialogHandler"),this.x1)};l.prototype.peg=function(Ha,Ya){var Na=!0;Na=void 0===Na?!1:Na;Ha=void 0===Ha?!1:Ha;Ya=void 0===Ya?5:Ya;this.x1&&this.x1.bodyControls&&(Na!==Object(H.a)(Object,this.x1.bodyControls).frameLoaded&&(Object(H.a)(Object,this.x1.bodyControls).frameLoaded=Na),Ha!==Object(H.a)(Object,this.x1.bodyControls).frameLoadSuccess&&
(Object(H.a)(Object,this.x1.bodyControls).frameLoadSuccess=Ha),Ya!==this.x1.dialogButtonsOption&&(this.x1.dialogButtonsOption=null,this.kc=Ya),this.update(this.x1))};l.prototype.WCj=function(Ha,Ya){var Na=new K.a(da.a.Iwj),eb={};Ha=(eb.signInLabel=CommonUIStrings.l_SignIn,eb.cancelLabel=CommonUIStrings.l_DialogCancel,eb.rtl=D.AFrameworkApplication.isRtl,eb.messageCorrelationId=Ha,eb.dialogStyles=Ya,eb);Na.Values=Ha;this.zv.hRa(Na,this.Gs.contentWindow,this.hY)};l.prototype.AVe=function(){this.peg(!1,
6)};l.prototype.eTi=function(){this.AVe()};l.prototype.M6g=function(){return this.Gs};l.prototype.Ewj=function(Ha){0===Ha&&(this.jyg.reject(Object.assign(new x,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.CDa(null))};Qk.Object.defineProperties(l.prototype,{C1f:{configurable:!0,enumerable:!0,get:function(){return this.Gs}},bfh:{configurable:!0,enumerable:!0,get:function(){var Ha=this;return this.Rng.then(function(Ya){Ha.c5d=!0;return Ya})}},cfh:{configurable:!0,
enumerable:!0,get:function(){return this.c5d}}});Object(y.a)(l,"SharedAuthConsentDialog",T.a,[675]);var W=b(1247),ca=b(95),ia=b(129),ea=b(47),qa=b(177),pa=b(338);d.prototype.Mvb=function(){return this.zXa};d.prototype.initialize=function(){var Ha=b(981).OAuthManager;if("loadFrame"in this.Tqa)return this.Tqa.loadFrame.Dte;if(!this.hY)return ca.Health.instance.recordKpiFailure(Ha.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),u.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),
Promise.reject(1);Ha=this.Cyc("loadFrame");this.oSb=ea.a.xe();var Ya=this.hY+this.Qge+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+D.AFrameworkApplication.userSessionId+"&WacUserType="+D.AFrameworkApplication.userType;this.ZWb&&(Ya+="&vnext=1");this.Gs=document.createElement("iframe");this.Zai(this.Gs);this.Gs.style.cssText="height:0;width:0;display:none;";this.Gs.id="SharedAuthFrame";this.Gs.setAttribute("name","SharedAuthFrame");this.Gs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.Gs.setAttribute("title","SharedAuthFrame");this.Gs.src=Ya;document.body.appendChild(this.Gs);Ya=ea.a.xe()-this.oSb;u.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Ya,this.Gs.src);return Ha};d.prototype.ujc=function(Ha){this.UEc=Ha;var Ya=new K.a(da.a.F1f);Ya.Values=this.dte(Ha);Ha=this.Cyc("initFrame");this.zv.hRa(Ya,this.Gs.contentWindow,this.hY);u.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return Ha};d.prototype.yS=function(Ha,Ya,Na,eb,Ia,lb){var hc=this,ma=new K.a(da.a.Jwj),Ja=this.K2e();ma.Values=this.Yag(Ha,Ya,Na,eb,Ia,lb,Ja);Ha=this.Cyc(Ja);eb&&D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.Lqg.enqueue(function(){return new Promise(function(Ta){hc.BOj(lb,ma,Ta,Ja)})}):(this.zv.hRa(ma,this.Gs.contentWindow,this.hY),u.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",
Ya));return Ha};d.prototype.BOj=function(Ha,Ya,Na,eb){var Ia=this.Tqa[eb];Ia&&(this.MXa=Ya,this.CDa=Object.assign(new n,{resolve:Na,correlationId:eb}),this.kM=new l(this.hY,this.Qge,Ha,this.zv,Ia,Na,this.ZWb),this.kM.ixc())};d.prototype.K2e=function(){return qa.a.create().toString()};d.prototype.Yag=function(Ha,Ya,Na,eb,Ia,lb,hc){var ma={};ma.appName=Ha;ma.appId=Ya;ma.target=Na;ma.withPopup=eb;ma.claims=Ia;ma.promptMessage=lb;ma.messageCorrelationId=hc;return ma};d.prototype.Zai=function(Ha){$addHandler(Ha,
"load",Object(la.a)(this,this.ZNi,"onIFrameLoaded"));$addHandler(Ha,"error",Object(la.a)(this,this.bnc,"onIFrameError"));this.zv.qFa(this.hY);this.zv.Xn(da.a.I1f);this.zv.Jl(da.a.I1f,Object(la.a)(this,this.ySi,"onScriptLoaded"));this.zv.Xn(da.a.H1f);this.zv.Jl(da.a.H1f,Object(la.a)(this,this.xSi,"onScriptInitialized"));this.zv.Xn(da.a.D1f);this.zv.Jl(da.a.D1f,Object(la.a)(this,this.CNi,"onGetTokenResponse"));this.zv.Xn(da.a.J1f);this.zv.Jl(da.a.J1f,Object(la.a)(this,this.uPi,"onLoginResponse"));this.zv.Xn(da.a.G1f);
this.zv.Jl(da.a.G1f,Object(la.a)(this,this.uOi,"onInteractiveFlowReady"));this.zv.Xn(da.a.E1f);this.zv.Jl(da.a.E1f,Object(la.a)(this,this.SNi,"onHideDialog"));this.zv.Xn(da.a.B1f);this.zv.Jl(da.a.B1f,Object(la.a)(this,this.YIi,"onCloseDialog"))};d.prototype.Cyc=function(Ha){var Ya=new f;Ya.startTime=ea.a.xe();var Na=new Promise(function(eb,Ia){Ya.resolve=eb;Ya.reject=Ia});Ya.Dte=Na;this.Tqa[Ha]=Ya;return Na};d.prototype.ZNi=function(){var Ha=ea.a.xe()-this.oSb;u.ULS.sendTraceTag(572346566,3E3,50,
"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",Ha)};d.prototype.bnc=function(Ha){var Ya=b(981).OAuthManager,Na=ea.a.xe()-this.oSb,eb=Object.assign(new pa.a,{durationMs:Na});ca.Health.instance.recordKpiFailure(Ya.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,eb);u.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Na,this.N5d?JSON.stringify(Ha):"")};d.prototype.ySi=function(Ha){var Ya=b(981).OAuthManager,Na=this.Tqa.loadFrame,eb=ea.a.xe()-Na.startTime,
Ia=Ha.Values.AuthLibrary.toString();Ha=Ha.Values.Success.toString();u.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",Ha,Ia,eb);Ia&&(this.zXa="SharedAuthTokenStrategy "+Ia);Ia=Boolean.parse(Ha);Ia||(Ha=ia.a.Vr(),void 0!==Ha&&null!==Ha&&(Ha.set("AuthLibrary",this.Mvb()),eb=Object.assign(new pa.a,{durationMs:eb,extendedProperties:Ha}),ca.Health.instance.recordKpiFailure(Ya.kpiName,"SharedAuthStrategyInitFailed",!1,!0,eb)));Na.resolve(Ia?
0:1)};d.prototype.xSi=function(Ha){var Ya=this;if(Ha.Values.interactive&&this.MXa&&this.MXa.Values.messageCorrelationId){var Na=this.MXa.Values.messageCorrelationId.toString();if(Ha.Values.interactive&&this.kM){this.kM.bfh.then(function(Ia){Ya.zv.hRa(Ya.MXa,Ya.kM.C1f.contentWindow,Ya.hY);Ya.kM.WCj(Na,Ia);Ya.kM.peg(!0);Ya.MXa=null});return}}Ha=this.Tqa.initFrame;var eb=ea.a.xe()-Ha.startTime;u.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",eb);Ha.resolve(0)};
d.prototype.CNi=function(Ha){if(Ha.Values.messageCorrelationId&&Ha.Values.messageCorrelationId.toString()){var Ya=Ha.Values.messageCorrelationId.toString(),Na=this.Tqa[Ya];if(Na){var eb=ea.a.xe()-Na.startTime;u.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",eb);Ha.Values.isSuccess&&Ha.Values.isSuccess?Na.resolve(Ha.Values.response):Na.reject(Ha.Values.response);this.mbg(Ya)}else u.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};d.prototype.uOi=function(){if(this.kM.cfh)this.kM.AVe();else if(this.UEc&&this.kM){var Ha=new K.a(da.a.F1f);Ha.Values=this.dte(this.UEc,!0);this.zv.hRa(Ha,this.kM.C1f.contentWindow,this.hY)}};d.prototype.SNi=function(){this.kM&&this.kM.Xwb()};d.prototype.YIi=function(Ha){Ha.Values.cancelled&&Ha.Values.cancelled&&Ha.Values.messageCorrelationId&&this.mbg(Ha.Values.messageCorrelationId.toString());this.kM&&
this.kM.hide()};d.prototype.dte=function(Ha,Ya){Ya=void 0===Ya?!1:Ya;var Na={};Na.appIds=this.lKh();Na.upn=Ha.loginHint;Na.authority=Ha.authority;Na.authorityType=Object(B.a)(I,Ha.authorityType);Na.tenantId=Ha.tenantId;Na.correlationId=D.AFrameworkApplication.userSessionId;Na.enableConsoleLogging=this.N5d;Na.enablePopupFlash=this.kog;Na.skipUpnCheck=this.Iwg;Na.interactive=Ya;return Na};d.prototype.lKh=function(){var Ha=[],Ya=V.a.nWc,Na;for(Na in Ya)Array.add(Ha,Ya[Na]);return Ha};d.prototype.rAc=
function(Ha,Ya,Na,eb,Ia,lb){var hc=new K.a(da.a.Hwj),ma=this.K2e();hc.Values=this.Yag(Ha,Ya,Na,eb,Ia,lb,ma);this.Rie=hc;Ha=this.Cyc(ma);u.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Ya);this.zAj();return Ha};d.prototype.Uyc=function(){return!0};d.prototype.zAj=function(){var Ha=this;this.Hjb||(this.Hjb=new ba.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Hjb.id=16,this.Hjb.Sff=!1,
this.Hjb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){u.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");Ha.zv.hRa(Ha.Rie,Ha.Gs.contentWindow,Ha.hY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),u.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};d.prototype.uPi=function(Ha){if(Ha.Values.messageCorrelationId&&Ha.Values.messageCorrelationId.toString()){var Ya=
this.Tqa[Ha.Values.messageCorrelationId.toString()];if(Ya){var Na=ea.a.xe()-Ya.startTime;u.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Na);Ha.Values.isSuccess&&Ha.Values.isSuccess?Ya.resolve(Ha.Values.response):Ya.reject(Ha.Values.response)}else u.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else u.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};
d.prototype.mbg=function(Ha){this.CDa&&this.CDa.correlationId===Ha&&(this.CDa.resolve(null),this.CDa=null)};Object(y.a)(d,"SharedAuthTokenStrategy",null,[656]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.ujc=function(){return Promise.resolve(0)};c.prototype.yS=function(){return Promise.resolve(Object.assign(new x,{IsSuccess:!1,ErrorCode:r.a[this.gPc],ErrorMessage:"Unable to get a token. Reason: ["+r.a[this.gPc]+"]"}))};c.prototype.rAc=function(){return Promise.resolve(Object.assign(new x,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.Uyc=function(){return!1};c.prototype.Mvb=function(){return this.zXa};Object(y.a)(c,"UnsupportedAuthTokenStrategy",null,[656]);var Pa=b(845);b.d(F,"OAuthManager",function(){return a});a.prototype.peh=function(){var Ha=V.a.JBi;Ha&&0<Ha.length?(this.SS=1,this.jP=new A(Ha)):D.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||D.AFrameworkApplication.ga.ra("IsO365CommercialHost")?
D.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.SS=2,this.jP=new c(this.SS)):(Ha=z.a.getAuthContext().loginHint)&&Ha.length?V.a.bxb?(this.SS=1,this.jP=new v):(this.SS=1,this.jP=new d):(this.SS=3,this.jP=new c(this.SS)):(this.SS=4,this.jP=new c(this.SS))};a.prototype.Pu=function(){return this.jP?this.jP.Mvb()||"Unknown":"None"};a.prototype.oeh=function(Ha){var Ya=this;Ha=void 0===Ha?null:Ha;u.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Na=ea.a.xe();return D.AFrameworkApplication.ga.Qed().then(function(eb){eb?
(Ya.peh(),Ha&&(Ya.jP=Ha),u.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",V.a.clientVersion,V.a.appVersion,V.a.whh,Ya.Pu(),Math.floor(ea.a.xe()-Na))):u.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ea.a.xe()-Na));return Promise.resolve(eb)},function(){u.ULS.sendTraceTag(562128580,3E3,
15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ea.a.xe()-Na));return Promise.resolve(!1)})};a.prototype.t$h=function(){var Ha=this;u.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.Pu());var Ya=ea.a.xe();return t.get(this.jP.initialize(),2,V.a.yFd).then(function(Na){if(0===Na)u.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));else if(1===
Na){u.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));var eb=ia.a.Vr();void 0!==eb&&null!==eb&&(eb.set("AuthLibrary",Ha.Pu()),eb=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.xe()-Ya),extendedProperties:eb}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,eb))}else 2===Na&&(u.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
Ha.Pu(),Math.floor(ea.a.xe()-Ya)),eb=ia.a.Vr(),void 0!==eb&&null!==eb&&(eb.set("AuthLibrary",Ha.Pu()),eb=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.xe()-Ya),extendedProperties:eb}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,eb)));return Promise.resolve(Na)},function(){u.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));return Promise.resolve(1)})};a.prototype.nti=
function(){var Ha=this;u.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.Pu());var Ya=ea.a.xe();return t.get(this.jP.ujc(z.a.getAuthContext()),2,V.a.yFd).then(function(Na){if(0===Na)u.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));else if(1===Na){u.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));var eb=ia.a.Vr();void 0!==eb&&null!==eb&&(eb.set("AuthLibrary",
Ha.Pu()),eb=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.xe()-Ya),extendedProperties:eb}),ca.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,eb))}else 2===Na&&(u.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Pu(),Math.floor(ea.a.xe()-Ya)),eb=ia.a.Vr(),void 0!==eb&&null!==eb&&(eb.set("AuthLibrary",Ha.Pu()),eb=Object.assign(new pa.a,{durationMs:Math.floor(ea.a.xe()-Ya),extendedProperties:eb}),ca.Health.instance.recordKpiFailure(a.kpiName,
"StrategyLoadTimedOut",!1,!0,eb)));return Promise.resolve(Na)},function(){u.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",Ha.Pu(),Math.floor(ea.a.xe()-Ya));return Promise.resolve(1)})};a.prototype.yS=function(Ha,Ya,Na){return this.pAc(Ha,Ya,!1,null,"",void 0===Na?null:Na)};a.prototype.Zag=function(Ha,Ya,Na,eb,Ia){return this.pAc(Ha,Ya,!0,Na,eb,void 0===Ia?null:Ia)};a.prototype.pAc=function(Ha,Ya,Na,eb,Ia,lb,hc){hc=void 0===hc?0:hc;
hc+=1;u.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",Ha,this.TQa(Ha,Ya),this.Pu(),hc);var ma=ia.a.Vr();void 0!==ma&&null!==ma&&(ma.set("AuthLibrary",this.Pu()),ma.set("AppName",Ha),ma.set("Target",this.TQa(Ha,Ya)),ca.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",ma));if(!V.a.isEnabled){var Ja;return this.Xtd((Ja=new x,Ja.IsSuccess=!1,Ja.Token=null,Ja.ErrorCode="NotEnabled",Ja.ErrorMessage="OAuthManager is disabled.",
Ja),Ha)}var Ta=V.a.nWc[Ha];if(void 0===Ta||null===Ta){u.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",Ha);var pb;return this.Xtd((pb=new x,pb.IsSuccess=!1,pb.Token=null,pb.ErrorCode="DisallowedApp",pb.ErrorMessage="Disallowed appName: "+Ha,pb),Ha)}var Db=ea.a.xe(),fb=this;ma=this.Aqg.then(function(db){return fb.dfi(Ha,Ta,Ya,Na,eb,Ia,lb,db)});Ja=Na?0:V.a.yFd;var xa;pb=(xa=new x,xa.IsSuccess=!1,xa.Token=null,
xa.ErrorCode="authTokenStrategy_timeout",xa.ErrorMessage="Auth Strategy timed out after ["+Ja+"] ms when fetching token",xa);var ya=this,Ga=this;return t.get(ma,pb,Ja).then(function(db){return hc<=a.cAi&&(db.ErrorCode===a.g$f||db.ErrorCode===a.yHj)?(u.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",hc,Math.floor(ea.a.xe()-Db)),ya.pAc(Ha,Ya,Na,eb,Ia,lb,hc)):db.ErrorCode===a.ijf&&!Na&&(u.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
hc,a.qLe),a.Wkh&&ya.jP.Uyc()&&ya.jP.rAc(Ha,Ta,Ya,Na,eb,Ia).then(function(Ob){return Promise.resolve(ya.Ojc(Ob,Ha,Ya,Ta,Db))}).catch(function(){var Ob,Ec=(Ob=new x,Ob.IsSuccess=!1,Ob.Token=null,Ob.ErrorCode="authTokenStrategy_failure",Ob.ErrorMessage="LoginPopup failed, GetToken could not be called",Ob);return Promise.resolve(ya.Ojc(Ec,Ha,Ya,Ta,Db))}),a.qLe)?ya.pAc(Ha,Ya,!0,eb,Ia,lb,hc):Promise.resolve(ya.Ojc(db,Ha,Ya,Ta,Db))}).catch(function(){var db,Ob=(db=new x,db.IsSuccess=!1,db.Token=null,db.ErrorCode=
"authTokenStrategy_failure",db.ErrorMessage="Auth Strategy failed with an unknown error",db);return Promise.resolve(Ga.Ojc(Ob,Ha,Ya,Ta,Db))})};a.prototype.dfi=function(Ha,Ya,Na,eb,Ia,lb,hc,ma){var Ja=this;return 1===ma||2===ma?this.Xtd(Object.assign(new x,{IsSuccess:!1,Token:null,ErrorCode:1===ma?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),Ha):this.jP.yS(Ha,Ya,Na,eb,Ia,lb,hc).then(function(Ta){return Promise.resolve(Ja.Msf(Ta,!0,Ha))}).catch(function(Ta){return Promise.resolve(Ja.Msf(Ta,
!1,Ha))})};a.prototype.Ojc=function(Ha,Ya,Na,eb,Ia){var lb={};Ia=ea.a.xe()-Ia;lb.IsSuccess=Ha.IsSuccess;lb.ErrorCode=Ha.IsSuccess?"Success":Ha.ErrorCode||"";lb.ErrorMessage=Ha.IsSuccess?"Success":this.TQa(Ya,Ha.ErrorMessage||"");lb.Target=this.TQa(Ya,Na||"");lb.TimeInMS=Math.floor(Ia);lb.AuthLibrary=this.Pu();lb.AppName=Ya;lb.AuthorityType=Object(B.a)(I,z.a.M$b());lb.UserType=this.W0h(z.a.getAuthContext());lb.IsAuthSupportedInSession=r.a[this.SS];lb.RequestCount=++this.Yug;lb.AppId=eb;u.ULS.sendTraceTag(593863640,
3E3,50,JSON.stringify(lb));Ha.IsSuccess||(Na=ia.a.Vr(),void 0!==Na&&null!==Na&&(Na.set("AppName",Ya),Na.set("AuthLibrary",this.Pu()),Na.set("ErrorCode",Ha.ErrorCode),Na.set("ErrorMessage",this.TQa(Ya,Ha.ErrorMessage)),Ya=Object.assign(new pa.a,{durationMs:Ia,extendedProperties:Na}),ca.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",!1,!0,Ya)));return Ha};a.prototype.Xtd=function(Ha,Ya){u.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",
Ya,this.TQa(Ya,Ha.ErrorMessage));var Na=ia.a.Vr();void 0!==Na&&null!==Na&&(Na.set("AppName",Ya),Na.set("AuthLibrary",this.Pu()),Na.set("ErrorCode",Ha.ErrorCode),Na.set("ErrorMessage",this.TQa(Ya,Ha.ErrorMessage)),Ya=Object.assign(new pa.a,{extendedProperties:Na}),ca.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",!1,!0,Ya));return Promise.resolve(Ha)};a.prototype.zef=function(Ha){return Ha===Pa.a.Gzc};a.prototype.TQa=function(Ha,Ya){return this.zef(Ha)&&Ya?"REDACTED":Ya};a.prototype.W0h=
function(Ha){return D.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!Ha.loginHint||1>Ha.loginHint.length?"empty":-1<Ha.loginHint.indexOf("guest#")?"guest":-1<Ha.loginHint.indexOf("ext#")?"external":0>Ha.upn.indexOf("@")?"no-at":"supported"};a.prototype.LLa=function(){return 1===this.SS};a.prototype.Msf=function(Ha,Ya,Na){var eb=null,Ia=null,lb=null,hc=null;Ha?Ha.ErrorCode||Ha.ErrorMessage?(Ia=Ha.ErrorCode?Ha.ErrorCode:a.LRe,lb=Ha.ErrorMessage?Ha.ErrorMessage:"No message"):Ha.Token?Ya?
eb=Ha.Token:(Ia=a.S$i,lb="A rejected promise returned a token."):(Ia=a.LRe,lb=JSON.stringify(Ha)):(Ia=a.hEi,lb="No result came from Auth Token Strategy");Ha&&Ha.Telemetry&&!this.zef(Na)&&(hc=Ha.Telemetry,u.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(hc)));if(Ia===a.VBi||Ia===a.eMj)Ia=a.g$f,lb="Auth Library Timed Out";Ia===a.VMg&&-1<lb.indexOf(a.$yg)&&(Ia=a.ijf);if(Ia||lb)eb=null;return Object.assign(new x,{IsSuccess:!!eb,Token:eb,ErrorCode:Ia,ErrorMessage:lb,Telemetry:hc})};Qk.Object.defineProperties(a,
{qLe:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},Wkh:{configurable:!0,enumerable:!0,get:function(){return D.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.eMj="token_renewal_error";a.LRe="Exception";a.hEi="NoResult";a.S$i="RejectToken";a.VBi="monitor_window_timeout";a.g$f="Timeout";a.yHj="authTokenStrategy_timeout";
a.VMg="login_required";a.$yg="AADSTS50058";a.ijf="Cookies Disabled";a.kpiName="OAuthManager";a.cAi=2;Object(y.a)(a,"OAuthManager",null,[537])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/ef2a700589e211229171f12e6b580883/EwaDS.oauth.js.map